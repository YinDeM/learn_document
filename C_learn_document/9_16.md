#### 9_16

##### 第7章 输入与输出

1. 文本流由一系列行组成，每一行结尾是一个换行符
2. 最简单的输入机制：int getchar(void)  从标准输入中一次读取一个字符（一般是键盘），使用getchar的程序也可以使用test <infile 进行字符读取,infile是文件名
    用户输入的字符被存放在键盘缓冲区中。直到用户按回车为止（回车字符也放在缓冲区中）。当用户键入回车之后，getchar才开始从stdio流中每次读入一个字符。
3. 输出：int putchar(int)   将字符c送至标准输出上，错误则返回EOF。同上，也可以使用重定向符号>将输出写入文件
4. 可以通过管道重定向输出到输入，或者重定向程序的输入到输出
5. 格式化输出：printf函数，返回值为打印的字符数。
    int printf(char *format, arg1, arg2, ...)
    format是一个格式字符串的指针。其中的格式字符串包含两种类型的对象，普通字符和转换说明。输出时，普通字符原封不动的复制到输出流，转换说明控制参数的转换和打印。
    - 负号：左对齐
    - 数字：指定最小字段宽度
    - 小数点，后边是精度输出位数，前边是最小字段宽度
    - 字母h或l，short类型和long类型打印
6. printf("%*.*s", 13, max, s);     *可以用后边的参数转换。动态数据，比如用长度转换     .*表示输出几位
7. sprintf(char *string, char *format, arg1, arg2, ...)
    按照format格式，格式化字符串到string中，string必须足够大以保存字符。
8. 格式化输入：scanf函数 从标准输入中读取字符序列，并按照format中的格式说明对字符序列进行解释，并将结果保存到其余的参数中。除了format其他参数都是指针，用来保存数据。
    返回值是成功匹配并赋值的输入项的个数。
9. int sscanf(char *string, char *format, arg1, arg2, ...)
    用于从一个字符串中读取字符序列，格式串中包含转换说明，空格和制表符将被忽略，普通字符用于匹配输入流中下一个非空白符字符
10. scanf函数可以和其他输入函数混合使用，无论调用哪个函数，下一个输入函数的调用都将从scanf函数没有读取的第一个字符处开始读取数据。
11. 文件访问：将用户需要使用的文件的外部名同读取数据的语句关联起来。
    读写一个文件之前，必须通过库函数fopen打开文件，这个函数就是用文件外部名与操作系统进行某些必要的连接和通信，并返回一个可以用于文件读写的指针，该指针称为文件指针。
    文件指针指向一个包含文件信息的结构，这些信息包括缓冲区的位置、缓冲区中当前字符位置等信息。
    FILE *fp;
    FILE fopen(char *name, char *mode);
    FILE是一个类型名，通过typedef定义的

    启动一个C语言程序时，操作系统环境会打开三个文件，并把这三个文件的指针提供给该程序。这三个程序分别为
    stdin       指向键盘
    stdout      指向显示器
    stderr      指向显示器
    stdin和stdout可以被重定向到文件或管道。
    文件格式化输入输出：fscanf和fprintf区别就是前边多出了一个FILE参数。
    int fclose(FILE *fp)：关闭文件，断开由fopen函数建立的文件指针和外部名之间的连接，并释放文件指针给其他文件使用
12. stderr：错误处理输出流，即使对标准输出进行了重定向，写到stderr中的输出通常也会显示在屏幕上。
    exit函数：终止调用程序的执行，任何调用该程序的进程都可以获得exit的参数值
    int ferror(FILE *fp):如果出错，返回一个非0值
    int feof(FILE *fp)与ferror类似，如果指定的文件到达文件结尾，返回一个非0值
13. char *fgets(char *line, int maxline, FILE *fp)
    该函数从fp指向的文件中读取下一个输入行，并将其存放在字符数组line中，最多可读取maxline-1个字符，读取的行以\0结尾存储在数组中。通常情况下函数返回line，但是如果出错或读到文件结尾返回NULL
14. int fputs(char *line, FILE *fp)
    该函数将一个字符串写入到一个文件中，如果发生错误返回一个EOF，否则返回一个非负值。
15. 一些常用函数：
    string.h
    ctype.h
    ungetc函数
    命令执行函数：int system(const char *command),先执行包含在字符串中的命令，然后继续执行当前程序
    存储管理函数：malloc和calloc用于动态的分配存储块
    - void *malloc(size_t n)        成功则返回一个指针，该指针指向n字节长度的未初始化的存储空间，失败返回NULL
    - void *calloc(size_t n, size_t size)       成功返回一个指针，该指针指向的空闲空间足以容纳由n个指定长度的对象组成的数组，否则返回NULL，该存储空间被初始化为0
    - free(p)   释放p指向的存储空间，p是通过上两个函数分配的指针，不能使用已经释放的存储空间
    数学函数：math.h
    随机数发生器函数：rand(),生成位于0和RAND_MAX之间的伪随机整数序列。
    生成大于等于0但是小于1的随机浮点数：#define frand() ((double) rand() / (RAND_MAX+1.0))


##### 第8章 UNIX系统接口
1. UNIX通过一系列的系统调用提供服务，这些服务调用实际上是操作系统内的函数，他们可以被用户程序调用。
2. UNIX中所有的外部设备都被看作是文件系统中的文件，所以所有的输入输出都要通过读文件和写文件完成。
    读或写文件之前需要将这个意图通知操作系统，这个过程称之为打开文件。系统会检查你的权限和文件是否存在，如果符合要求，操作系统将向程序返回一个小的非负整数，该整数称为文件描述符。
    任何时候对文件的输入输出都是通过文件描述符标识文件
    大多数输入和输出都是通过

3. 低级I/O--read和write
    输入和输出是通过read和write系统调用实现的。
    int n_read = read(int fd, void *buf, int n);
    int n_write = write(int fd, void *buf, int n);
    fd是文件描述符，buf是程序中存放读或写的数据的字符数组，n是要传输的字节数，返回值是实际传输的字节数。
    读文件：返回值为0表示已经读到文件的结尾，返回值为-1表示发生了某种错误。
    写文件：返回值是实际写入的字节数，如果返回值和请求写入的字节数不相等，则说明发生了错误。
4. 除了默认的标准输入、标准输出和标准错误文件外，其他文件都必须在读或写之前显式的打开。
    系统调用open和creat实现打开文件功能。
    int open(char *name, int flags, int perms);
    name是一个包含文件名的字符串，flags是一个int型的值，说明以何种形式打开文件（O_RDONLY、O_WRONLY、O_RDWR），perms设置文件访问权限的初始值（第三个参数是在第二个参数中有O_CREAT时才用作用。若没有，则第三个参数可以忽略，可以设置为0）
    成功则返回一个文件描述符，如果发生错误返回-1
    int creat(char *name, int perms);
    创建新文件或覆盖原有的文件，如果创建成功则返回一个文件描述符，失败则返回-1
    int vfprintf(FILE *stream, const char *format, va_list arg)
    使用参数列表发送格式化输出到流 stream 中。arg -- 一个表示可变参数列表的对象。
5. 输入输出通常是顺序进行的，每次调用read和write进行读写的位置紧跟在前一次操作的位置之后。
    C语言提供了lseek系统调用，可以在文件的任意移动位置而不实际读写数据。
    long lseek(int fd, long offset, int origin);
    将文件fd的当前位置设置为offset，offset的值是相对origin的位置的。随后进行的读写操作将从此位置开始。origin的值可以设置为0、1、2，分别用于指定offset从文件开始、从当前位置或从文件结束处开始算起。返回一个long类型的值，此值表示文件的新位置，出错返回-1
    用例：为了向一个文件的尾部添加内容，需要使用lseek(fd, 0L, 2);找到文件的末尾。
6. 



